= content_for :header_title_right_col do
  = render "shared/buttons/download_button", url: app_users_path(filter_params.merge(format: :xlsx))

.container-fluid.px-4{'data-controller' => 'app-users'}
  = render 'shared/header_title', title: t('app_user.app_users')
  = render "filters"
  = render "shared/no_data", items: @app_users

  - if @app_users.present?
    = render "shared/pagination_title", objects: @app_users

    .table-responsive
      %table.table.table-hover.pretty
        %thead
          %tr
            %th #
            %th= t('app_user.gender')
            %th= t('app_user.age')
            %th= t('app_user.province')
            %th= t('app_user.characteristic')
            %th= t('shared.device_id')
            %th= t('app_user.registered_at')
            %th= t('app_user.last_accessed_at')
            %th= t('app_user.number_of_quiz')
            %th= t('shared.created_at')

        %tbody
          - @app_users.each_with_index do |app_user, index|
            %tr
              %td= @pagy.from + index
              %td
                - if app_user.anonymous?
                  %span{'data-bs-toggle': 'tooltip', title: t('app_user.anonymous')}
                    %i.fa-solid.fa-user-secret
                - else
                  = t("app_user.#{app_user.gender}")

              %td
                = app_user.age unless app_user.anonymous?

              %td
                = app_user.province["name_#{I18n.locale}"] unless app_user.anonymous?
              %td= app_user.characteristics.map(&:"name_#{I18n.locale}").join(', ')
              %td= app_user.device_id
              %td= timeago(app_user.registered_at).html_safe
              %td= timeago(app_user.last_accessed_at).html_safe
              %td
                = link_to app_user.quizzes.length, app_user_quizzes_path(app_user), class: 'btn btn-link' if app_user.quizzes.length.positive?

              %td= timeago(app_user.created_at).html_safe

    - if @pagy.pages > 1
      .d-flex.pagy-wrapper.justify-content-lg-end.justify-content-center
        != pagy_bootstrap_nav(@pagy)
